<div class="max-w-3xl">
  <%# Back Link %>
  <div class="mb-8">
    <%= link_to "&larr; #{t('actions.back')}".html_safe, jobs_path, class: "text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors" %>
  </div>

  <%# Owner/Employer Banner %>
  <% if user_signed_in? && current_user == @job.user %>
    <div class="mb-6 p-4 border <%= @job.approved? ? 'border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20' : 'border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20' %>">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <% if @job.approved? %>
            <span class="font-medium text-green-800 dark:text-green-300">Published</span>
            <span class="text-sm text-green-600 dark:text-green-400">— Your job is visible to candidates</span>
          <% else %>
            <span class="font-medium text-yellow-800 dark:text-yellow-300">Pending</span>
            <% if @job.payment_date.blank? %>
              <span class="text-sm text-yellow-600 dark:text-yellow-400">— Payment required to publish</span>
            <% else %>
              <span class="text-sm text-yellow-600 dark:text-yellow-400">— Awaiting admin approval</span>
            <% end %>
          <% end %>
        </div>
        <div class="flex gap-2">
          <% if @job.payment_date.blank? %>
            <%= button_to "Pay to Publish ($#{JOB_POSTING_PRICE})", payment_create_path(job_id: @job.id), method: :post, class: "bg-job-blue hover:bg-job-blue-dark text-white px-4 py-2 font-medium transition-colors" %>
          <% end %>
          <%= link_to t("actions.edit"), edit_job_path(@job), class: "border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" %>
        </div>
      </div>
    </div>
  <% end %>

  <%# Job Header %>
  <header class="mb-12">
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2"><%= @job.title %></h1>
    <p class="text-xl text-gray-600 dark:text-gray-300 mb-6"><%= @job.company %></p>

    <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-500 dark:text-gray-400 mb-8">
      <% if @job.sector %>
        <span><%= @job.sector.name %></span>
      <% end %>
      <% if @job.jobtype %>
        <span><%= @job.jobtype.name %></span>
      <% end %>
      <% if @job.city || @job.country %>
        <span><%= [@job.city&.name, @job.country&.name].compact.join(", ") %></span>
      <% end %>
      <span><%= t("jobs.posted") %> <%= l(@job.post_date, format: :long) %></span>
    </div>

    <%# Apply Button %>
    <% if @job.apply_url.present? %>
      <%= link_to @job.apply_url, target: "_blank", rel: "noopener", class: "inline-block bg-job-blue hover:bg-job-blue-dark text-white px-6 py-3 font-medium transition-colors" do %>
        <%= t("jobs.apply_external") %> &rarr;
      <% end %>
    <% elsif user_signed_in? && current_user.job_seeker? %>
      <%= link_to t("jobs.apply_now"), apply_job_path(@job), class: "inline-block bg-job-blue hover:bg-job-blue-dark text-white px-6 py-3 font-medium transition-colors" %>
    <% else %>
      <%= link_to t("jobs.apply_now"), new_user_session_path, class: "inline-block bg-job-blue hover:bg-job-blue-dark text-white px-6 py-3 font-medium transition-colors" %>
    <% end %>
  </header>

  <%# Job Description %>
  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-4"><%= t("jobs.description") %></h2>
    <div class="prose prose-gray dark:prose-invert max-w-none">
      <%= simple_format(@job.description) %>
    </div>
  </section>

  <%# Qualifications %>
  <% if @job.qualifications.present? %>
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-4"><%= t("jobs.qualifications") %></h2>
      <div class="prose prose-gray dark:prose-invert max-w-none">
        <%= simple_format(@job.qualifications) %>
      </div>
    </section>
  <% end %>

  <%# Company Info %>
  <% if @job.company_description.present? %>
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-4"><%= t("jobs.company") %></h2>
      <div class="prose prose-gray dark:prose-invert max-w-none">
        <%= simple_format(@job.company_description) %>
      </div>
      <% if @job.company_url.present? %>
        <p class="mt-4">
          <%= link_to @job.company_url, @job.company_url, target: "_blank", rel: "noopener", class: "text-job-blue hover:text-job-blue-dark dark:hover:text-job-blue-light transition-colors" %>
        </p>
      <% end %>
    </section>
  <% end %>

  <%# Related Jobs %>
  <% if @related_jobs.any? %>
    <section class="border-t border-gray-200 dark:border-gray-800 pt-12">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Similar Jobs</h2>
      <div class="space-y-6">
        <% @related_jobs.each do |job| %>
          <div class="group">
            <h3 class="font-medium text-gray-900 dark:text-white group-hover:text-job-blue dark:group-hover:text-job-blue-light transition-colors">
              <%= link_to job.title, job %>
            </h3>
            <p class="text-sm text-gray-500 dark:text-gray-400"><%= job.company %> &middot; <%= [job.city&.name, job.country&.name].compact.join(", ") %></p>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>
</div>
